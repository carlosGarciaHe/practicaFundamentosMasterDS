<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>3 ETL | Banco</title>
  <meta name="description" content="3 ETL | Banco" />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="3 ETL | Banco" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="3 ETL | Banco" />
  
  
  

<meta name="author" content="Carlos, Alberto y Juan Ramón" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="análisis-exploratorio-variables.html"/>
<link rel="next" href="modelado.html"/>
<script src="book_assets/jquery-2.2.3/jquery.min.js"></script>
<link href="book_assets/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="book_assets/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="book_assets/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="book_assets/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="book_assets/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="book_assets/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="book_assets/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="book_assets/accessible-code-block-0.0.1/empty-anchor.js"></script>
<link href="book_assets/anchor-sections-1.0/anchor-sections.css" rel="stylesheet" />
<script src="book_assets/anchor-sections-1.0/anchor-sections.js"></script>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="introducción-y-objetivos.html"><a href="introducción-y-objetivos.html"><i class="fa fa-check"></i><b>1</b> Introducción y objetivos</a><ul>
<li class="chapter" data-level="1.1" data-path="introducción-y-objetivos.html"><a href="introducción-y-objetivos.html#introducción"><i class="fa fa-check"></i><b>1.1</b> Introducción</a></li>
<li class="chapter" data-level="1.2" data-path="introducción-y-objetivos.html"><a href="introducción-y-objetivos.html#objetivos"><i class="fa fa-check"></i><b>1.2</b> Objetivos</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="análisis-exploratorio-variables.html"><a href="análisis-exploratorio-variables.html"><i class="fa fa-check"></i><b>2</b> ANÁLISIS EXPLORATORIO VARIABLES</a><ul>
<li class="chapter" data-level="2.1" data-path="análisis-exploratorio-variables.html"><a href="análisis-exploratorio-variables.html#importación-dataset"><i class="fa fa-check"></i><b>2.1</b> Importación dataset</a></li>
<li class="chapter" data-level="2.2" data-path="análisis-exploratorio-variables.html"><a href="análisis-exploratorio-variables.html#división-en-train-y-test"><i class="fa fa-check"></i><b>2.2</b> División en train y test</a></li>
<li class="chapter" data-level="2.3" data-path="análisis-exploratorio-variables.html"><a href="análisis-exploratorio-variables.html#estructura-y-resumen-de-train"><i class="fa fa-check"></i><b>2.3</b> Estructura y resumen de train</a></li>
<li class="chapter" data-level="2.4" data-path="análisis-exploratorio-variables.html"><a href="análisis-exploratorio-variables.html#exploratorio-univariante-de-las-variables-predictoras"><i class="fa fa-check"></i><b>2.4</b> Exploratorio univariante de las variables predictoras</a><ul>
<li class="chapter" data-level="2.4.1" data-path="análisis-exploratorio-variables.html"><a href="análisis-exploratorio-variables.html#variable-age"><i class="fa fa-check"></i><b>2.4.1</b> Variable age</a></li>
<li class="chapter" data-level="2.4.2" data-path="análisis-exploratorio-variables.html"><a href="análisis-exploratorio-variables.html#variable-balance"><i class="fa fa-check"></i><b>2.4.2</b> Variable balance</a></li>
<li class="chapter" data-level="2.4.3" data-path="análisis-exploratorio-variables.html"><a href="análisis-exploratorio-variables.html#variable-job"><i class="fa fa-check"></i><b>2.4.3</b> Variable job</a></li>
<li class="chapter" data-level="2.4.4" data-path="análisis-exploratorio-variables.html"><a href="análisis-exploratorio-variables.html#variable-marital"><i class="fa fa-check"></i><b>2.4.4</b> Variable marital</a></li>
<li class="chapter" data-level="2.4.5" data-path="análisis-exploratorio-variables.html"><a href="análisis-exploratorio-variables.html#variable-education"><i class="fa fa-check"></i><b>2.4.5</b> Variable education</a></li>
<li class="chapter" data-level="2.4.6" data-path="análisis-exploratorio-variables.html"><a href="análisis-exploratorio-variables.html#variable-default"><i class="fa fa-check"></i><b>2.4.6</b> Variable default</a></li>
<li class="chapter" data-level="2.4.7" data-path="análisis-exploratorio-variables.html"><a href="análisis-exploratorio-variables.html#variable-housing"><i class="fa fa-check"></i><b>2.4.7</b> Variable housing</a></li>
<li class="chapter" data-level="2.4.8" data-path="análisis-exploratorio-variables.html"><a href="análisis-exploratorio-variables.html#variable-loan"><i class="fa fa-check"></i><b>2.4.8</b> Variable loan</a></li>
<li class="chapter" data-level="2.4.9" data-path="análisis-exploratorio-variables.html"><a href="análisis-exploratorio-variables.html#variable-contact"><i class="fa fa-check"></i><b>2.4.9</b> Variable contact</a></li>
<li class="chapter" data-level="2.4.10" data-path="análisis-exploratorio-variables.html"><a href="análisis-exploratorio-variables.html#variable-mes"><i class="fa fa-check"></i><b>2.4.10</b> Variable mes</a></li>
<li class="chapter" data-level="2.4.11" data-path="análisis-exploratorio-variables.html"><a href="análisis-exploratorio-variables.html#variable-day"><i class="fa fa-check"></i><b>2.4.11</b> Variable day</a></li>
<li class="chapter" data-level="2.4.12" data-path="análisis-exploratorio-variables.html"><a href="análisis-exploratorio-variables.html#variable-duration"><i class="fa fa-check"></i><b>2.4.12</b> Variable duration</a></li>
<li class="chapter" data-level="2.4.13" data-path="análisis-exploratorio-variables.html"><a href="análisis-exploratorio-variables.html#variable-campaign"><i class="fa fa-check"></i><b>2.4.13</b> Variable campaign</a></li>
<li class="chapter" data-level="2.4.14" data-path="análisis-exploratorio-variables.html"><a href="análisis-exploratorio-variables.html#variable-pdays"><i class="fa fa-check"></i><b>2.4.14</b> Variable pdays</a></li>
<li class="chapter" data-level="2.4.15" data-path="análisis-exploratorio-variables.html"><a href="análisis-exploratorio-variables.html#variable-poutcome"><i class="fa fa-check"></i><b>2.4.15</b> Variable poutcome</a></li>
<li class="chapter" data-level="2.4.16" data-path="análisis-exploratorio-variables.html"><a href="análisis-exploratorio-variables.html#variable-previous"><i class="fa fa-check"></i><b>2.4.16</b> Variable previous</a></li>
<li class="chapter" data-level="2.4.17" data-path="análisis-exploratorio-variables.html"><a href="análisis-exploratorio-variables.html#variable-term_deposit-objetivo"><i class="fa fa-check"></i><b>2.4.17</b> Variable term_deposit (Objetivo)</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="análisis-exploratorio-variables.html"><a href="análisis-exploratorio-variables.html#exploratorio-multivariante"><i class="fa fa-check"></i><b>2.5</b> Exploratorio multivariante</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="etl.html"><a href="etl.html"><i class="fa fa-check"></i><b>3</b> ETL</a><ul>
<li class="chapter" data-level="3.1" data-path="etl.html"><a href="etl.html#tratamiento-de-datos-faltantes"><i class="fa fa-check"></i><b>3.1</b> Tratamiento de datos faltantes</a></li>
<li class="chapter" data-level="3.2" data-path="etl.html"><a href="etl.html#transformación-de-variables"><i class="fa fa-check"></i><b>3.2</b> Transformación de variables</a><ul>
<li class="chapter" data-level="3.2.1" data-path="etl.html"><a href="etl.html#train-poutcome"><i class="fa fa-check"></i><b>3.2.1</b> Train poutcome</a></li>
<li class="chapter" data-level="3.2.2" data-path="etl.html"><a href="etl.html#variable-previous-1"><i class="fa fa-check"></i><b>3.2.2</b> Variable previous</a></li>
<li class="chapter" data-level="3.2.3" data-path="etl.html"><a href="etl.html#variable-pdays-1"><i class="fa fa-check"></i><b>3.2.3</b> Variable pdays</a></li>
<li class="chapter" data-level="3.2.4" data-path="etl.html"><a href="etl.html#variable-campaign-1"><i class="fa fa-check"></i><b>3.2.4</b> Variable campaign</a></li>
<li class="chapter" data-level="3.2.5" data-path="etl.html"><a href="etl.html#variable-duration-1"><i class="fa fa-check"></i><b>3.2.5</b> Variable duration</a></li>
<li class="chapter" data-level="3.2.6" data-path="etl.html"><a href="etl.html#variable-month"><i class="fa fa-check"></i><b>3.2.6</b> Variable month</a></li>
<li class="chapter" data-level="3.2.7" data-path="etl.html"><a href="etl.html#variable-contact-1"><i class="fa fa-check"></i><b>3.2.7</b> Variable contact</a></li>
<li class="chapter" data-level="3.2.8" data-path="etl.html"><a href="etl.html#variable-balance-1"><i class="fa fa-check"></i><b>3.2.8</b> Variable balance</a></li>
<li class="chapter" data-level="3.2.9" data-path="etl.html"><a href="etl.html#variable-age-1"><i class="fa fa-check"></i><b>3.2.9</b> Variable age</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="etl.html"><a href="etl.html#selección-de-variables"><i class="fa fa-check"></i><b>3.3</b> Selección de variables</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="modelado.html"><a href="modelado.html"><i class="fa fa-check"></i><b>4</b> Modelado</a></li>
<li class="chapter" data-level="5" data-path="evaluación.html"><a href="evaluación.html"><i class="fa fa-check"></i><b>5</b> Evaluación</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Banco</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="etl" class="section level1">
<h1><span class="header-section-number">3</span> ETL</h1>
<div id="tratamiento-de-datos-faltantes" class="section level2">
<h2><span class="header-section-number">3.1</span> Tratamiento de datos faltantes</h2>
<p>Las columnas que presentan datos faltantes son <strong>job</strong> y <strong>education</strong> donde venían codificados bajo la categoría unknown. Es lógico pensar que dicha categoría no sean NaNs sino una categoría propia con capacidad informativa por sí sola. Pero en el EDA no hemos observado una distribución diferente a la del resto de categorías, a diferencia de para contact o poutcome donde unknown si parece ser una categoría propia.</p>
<p>El método de imputación utilizado aquí es sencillo. Se utiliza un RandomForest para predecir cada uno de los valores faltantes a partir del resto de variables predictoras que tenemos.</p>
<div class="sourceCode" id="cb378"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb378-1"><a href="etl.html#cb378-1"></a>train =<span class="st"> </span>data[trainIndex ,]</span>
<span id="cb378-2"><a href="etl.html#cb378-2"></a>train[train<span class="op">$</span>education<span class="op">==</span><span class="st">&#39;unknown&#39;</span>,<span class="st">&quot;education&quot;</span>] &lt;-<span class="st"> </span><span class="ot">NA</span></span>
<span id="cb378-3"><a href="etl.html#cb378-3"></a>train[train<span class="op">$</span>job<span class="op">==</span><span class="st">&#39;unknown&#39;</span>,<span class="st">&quot;job&quot;</span>] &lt;-<span class="st"> </span><span class="ot">NA</span></span></code></pre></div>
<div class="sourceCode" id="cb379"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb379-1"><a href="etl.html#cb379-1"></a>train &lt;-<span class="st"> </span>train <span class="op">%&gt;%</span></span>
<span id="cb379-2"><a href="etl.html#cb379-2"></a><span class="st">    </span><span class="kw">mutate</span>(</span>
<span id="cb379-3"><a href="etl.html#cb379-3"></a>        <span class="dt">job =</span> <span class="kw">as.factor</span>(job),</span>
<span id="cb379-4"><a href="etl.html#cb379-4"></a>        <span class="dt">education =</span> <span class="kw">as.factor</span>(education)</span>
<span id="cb379-5"><a href="etl.html#cb379-5"></a>    )</span></code></pre></div>
<div class="sourceCode" id="cb380"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb380-1"><a href="etl.html#cb380-1"></a>d &lt;-<span class="st"> </span><span class="kw">describe</span>(train)</span>
<span id="cb380-2"><a href="etl.html#cb380-2"></a>d[<span class="kw">c</span>(<span class="st">&#39;job&#39;</span>,<span class="st">&#39;education&#39;</span>)]</span></code></pre></div>
<pre><code>## train 
## 
##  2  Variables      34111  Observations
## --------------------------------------------------------------------------------
## job 
##        n  missing distinct 
##    33904      207       11 
## 
## lowest : admin.        blue-collar   entrepreneur  housemaid     management   
## highest: self-employed services      student       technician    unemployed   
## 
## admin. (3892, 0.115), blue-collar (7608, 0.224), entrepreneur (1137, 0.034),
## housemaid (937, 0.028), management (7130, 0.210), retired (1503, 0.044),
## self-employed (1183, 0.035), services (3215, 0.095), student (581, 0.017),
## technician (5763, 0.170), unemployed (955, 0.028)
## --------------------------------------------------------------------------------
## education 
##        n  missing distinct 
##    32764     1347        3 
##                                         
## Value        primary secondary  tertiary
## Frequency       5272     17645      9847
## Proportion     0.161     0.539     0.301
## --------------------------------------------------------------------------------</code></pre>
<p>La siguiente visualización nos indica que no parece existir ningún patrón en la falta de valores, el patrón más común es donde a la observación solo le falta el valor para <strong>education</strong>, algo lógico ya que es una variable con el ratio de valores missing más alto.</p>
<div class="sourceCode" id="cb382"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb382-1"><a href="etl.html#cb382-1"></a>aggr_plot &lt;-<span class="st"> </span><span class="kw">aggr</span>(train, <span class="dt">col=</span><span class="kw">c</span>(<span class="st">&#39;navyblue&#39;</span>,<span class="st">&#39;red&#39;</span>), <span class="dt">numbers=</span><span class="ot">TRUE</span>, <span class="dt">sortVars=</span><span class="ot">TRUE</span>,</span>
<span id="cb382-2"><a href="etl.html#cb382-2"></a> <span class="dt">labels=</span><span class="kw">names</span>(train), <span class="dt">cex.axis=</span>.<span class="dv">7</span>, <span class="dt">gap=</span><span class="dv">3</span>, <span class="dt">cex.numbers=</span><span class="fl">0.5</span>,</span>
<span id="cb382-3"><a href="etl.html#cb382-3"></a> <span class="dt">ylab=</span><span class="kw">c</span>(<span class="st">&quot;Histogram of missing data&quot;</span>,<span class="st">&quot;Pattern&quot;</span>))</span></code></pre></div>
<p><img src="bookDown_files/figure-html/unnamed-chunk-145-1.png" width="672" /></p>
<pre><code>## 
##  Variables sorted by number of missings: 
##      Variable       Count
##     education 0.039488728
##           job 0.006068424
##           age 0.000000000
##       marital 0.000000000
##       default 0.000000000
##       balance 0.000000000
##       housing 0.000000000
##          loan 0.000000000
##       contact 0.000000000
##           day 0.000000000
##         month 0.000000000
##      duration 0.000000000
##      campaign 0.000000000
##         pdays 0.000000000
##      previous 0.000000000
##      poutcome 0.000000000
##  term_deposit 0.000000000</code></pre>
<p>Realizamos la imputación de valores.</p>
<div class="sourceCode" id="cb384"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb384-1"><a href="etl.html#cb384-1"></a>train_imputed =<span class="st"> </span><span class="kw">missRanger</span>(train, <span class="dt">num.trees =</span> <span class="dv">100</span>)</span></code></pre></div>
<pre><code>## 
## Missing value imputation by random forests
## 
##   Variables to impute:       job, education
##   Variables used to impute:  age, job, marital, education, default, balance, housing, loan, contact, day, month, duration, campaign, pdays, previous, poutcome, term_deposit
## iter 1:  ..
## iter 2:  ..
## iter 3:  ..
## iter 4:  ..</code></pre>
<div class="sourceCode" id="cb386"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb386-1"><a href="etl.html#cb386-1"></a><span class="kw">summary</span>(train_imputed)</span></code></pre></div>
<pre><code>##       age                 job         marital              education    
##  Min.   :18.00   blue-collar:7699   Length:34111       primary  : 5505  
##  1st Qu.:33.00   management :7199   Class :character   secondary:18500  
##  Median :39.00   technician :5771   Mode  :character   tertiary :10106  
##  Mean   :40.79   admin.     :3895                                       
##  3rd Qu.:48.00   services   :3216                                       
##  Max.   :95.00   retired    :1534                                       
##                  (Other)    :4797                                       
##    default             balance           housing              loan          
##  Length:34111       Min.   : -8019.0   Length:34111       Length:34111      
##  Class :character   1st Qu.:    63.5   Class :character   Class :character  
##  Mode  :character   Median :   432.0   Mode  :character   Mode  :character  
##                     Mean   :  1345.1                                        
##                     3rd Qu.:  1392.5                                        
##                     Max.   :102127.0                                        
##                                                                             
##    contact               day           month              duration     
##  Length:34111       Min.   : 1.00   Length:34111       Min.   :   0.0  
##  Class :character   1st Qu.: 8.00   Class :character   1st Qu.: 100.0  
##  Mode  :character   Median :16.00   Mode  :character   Median : 176.0  
##                     Mean   :15.84                      Mean   : 255.6  
##                     3rd Qu.:21.00                      3rd Qu.: 315.0  
##                     Max.   :31.00                      Max.   :4918.0  
##                                                                        
##     campaign         pdays          previous          poutcome        
##  Min.   : 1.00   Min.   : -1.0   Min.   :  0.0000   Length:34111      
##  1st Qu.: 1.00   1st Qu.: -1.0   1st Qu.:  0.0000   Class :character  
##  Median : 2.00   Median : -1.0   Median :  0.0000   Mode  :character  
##  Mean   : 2.81   Mean   : 34.1   Mean   :  0.4633                     
##  3rd Qu.: 3.00   3rd Qu.: -1.0   3rd Qu.:  0.0000                     
##  Max.   :63.00   Max.   :536.0   Max.   :275.0000                     
##                                                                       
##  term_deposit      
##  Length:34111      
##  Class :character  
##  Mode  :character  
##                    
##                    
##                    
## </code></pre>
<div class="sourceCode" id="cb388"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb388-1"><a href="etl.html#cb388-1"></a><span class="kw">describe</span>(train_imputed)</span></code></pre></div>
<pre><code>## train_imputed 
## 
##  17  Variables      34111  Observations
## --------------------------------------------------------------------------------
## age 
##        n  missing distinct     Info     Mean      Gmd      .05      .10 
##    34111        0       74    0.999    40.79    11.47       27       29 
##      .25      .50      .75      .90      .95 
##       33       39       48       56       58 
## 
## lowest : 18 19 20 21 22, highest: 87 89 90 92 95
## --------------------------------------------------------------------------------
## job 
##        n  missing distinct 
##    34111        0       11 
## 
## lowest : admin.        blue-collar   entrepreneur  housemaid     management   
## highest: self-employed services      student       technician    unemployed   
## 
## admin. (3895, 0.114), blue-collar (7699, 0.226), entrepreneur (1137, 0.033),
## housemaid (939, 0.028), management (7199, 0.211), retired (1534, 0.045),
## self-employed (1183, 0.035), services (3216, 0.094), student (582, 0.017),
## technician (5771, 0.169), unemployed (956, 0.028)
## --------------------------------------------------------------------------------
## marital 
##        n  missing distinct 
##    34111        0        3 
##                                      
## Value      divorced  married   single
## Frequency      3982    20680     9449
## Proportion    0.117    0.606    0.277
## --------------------------------------------------------------------------------
## education 
##        n  missing distinct 
##    34111        0        3 
##                                         
## Value        primary secondary  tertiary
## Frequency       5505     18500     10106
## Proportion     0.161     0.542     0.296
## --------------------------------------------------------------------------------
## default 
##        n  missing distinct 
##    34111        0        2 
##                       
## Value         no   yes
## Frequency  33463   648
## Proportion 0.981 0.019
## --------------------------------------------------------------------------------
## balance 
##        n  missing distinct     Info     Mean      Gmd      .05      .10 
##    34111        0     6531    0.999     1345     2045   -191.0      0.0 
##      .25      .50      .75      .90      .95 
##     63.5    432.0   1392.5   3570.0   5771.0 
## 
## lowest :  -8019  -6847  -4057  -3372  -3313, highest:  64343  66721  71188  81204 102127
## --------------------------------------------------------------------------------
## housing 
##        n  missing distinct 
##    34111        0        2 
##                       
## Value         no   yes
## Frequency  14509 19602
## Proportion 0.425 0.575
## --------------------------------------------------------------------------------
## loan 
##        n  missing distinct 
##    34111        0        2 
##                       
## Value         no   yes
## Frequency  28463  5648
## Proportion 0.834 0.166
## --------------------------------------------------------------------------------
## contact 
##        n  missing distinct 
##    34111        0        3 
##                                         
## Value       cellular telephone   unknown
## Frequency      21769      2097     10245
## Proportion     0.638     0.061     0.300
## --------------------------------------------------------------------------------
## day 
##        n  missing distinct     Info     Mean      Gmd      .05      .10 
##    34111        0       31    0.998    15.84    9.544        3        5 
##      .25      .50      .75      .90      .95 
##        8       16       21       28       30 
## 
## lowest :  1  2  3  4  5, highest: 27 28 29 30 31
## --------------------------------------------------------------------------------
## month 
##        n  missing distinct 
##    34111        0       12 
## 
## lowest : apr aug dec feb jan, highest: mar may nov oct sep
##                                                                             
## Value        apr   aug   dec   feb   jan   jul   jun   mar   may   nov   oct
## Frequency   2142  4813   171  1823   969  5244  4125   214 10852  3113   419
## Proportion 0.063 0.141 0.005 0.053 0.028 0.154 0.121 0.006 0.318 0.091 0.012
##                 
## Value        sep
## Frequency    226
## Proportion 0.007
## --------------------------------------------------------------------------------
## duration 
##        n  missing distinct     Info     Mean      Gmd      .05      .10 
##    34111        0     1485        1    255.6      235       35       58 
##      .25      .50      .75      .90      .95 
##      100      176      315      544      749 
## 
## lowest :    0    2    3    4    5, highest: 3284 3322 3366 3881 4918
## --------------------------------------------------------------------------------
## campaign 
##        n  missing distinct     Info     Mean      Gmd      .05      .10 
##    34111        0       45    0.921     2.81    2.435        1        1 
##      .25      .50      .75      .90      .95 
##        1        2        3        5        8 
## 
## lowest :  1  2  3  4  5, highest: 43 44 55 58 63
## --------------------------------------------------------------------------------
## pdays 
##        n  missing distinct     Info     Mean      Gmd      .05      .10 
##    34111        0      409    0.393     34.1    62.25       -1       -1 
##      .25      .50      .75      .90      .95 
##       -1       -1       -1      175      301 
## 
## lowest :  -1   1   2   4   5, highest: 495 515 518 520 536
## --------------------------------------------------------------------------------
## previous 
##        n  missing distinct     Info     Mean      Gmd      .05      .10 
##    34111        0       36    0.393   0.4633   0.8488        0        0 
##      .25      .50      .75      .90      .95 
##        0        0        0        1        3 
## 
## lowest :   0   1   2   3   4, highest:  37  38  51  58 275
## --------------------------------------------------------------------------------
## poutcome 
##        n  missing distinct 
##    34111        0        4 
##                                           
## Value      failure   other success unknown
## Frequency     3401    1201     625   28884
## Proportion   0.100   0.035   0.018   0.847
## --------------------------------------------------------------------------------
## term_deposit 
##        n  missing distinct 
##    34111        0        2 
##                       
## Value         no   yes
## Frequency  30938  3173
## Proportion 0.907 0.093
## --------------------------------------------------------------------------------</code></pre>
<div class="sourceCode" id="cb390"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb390-1"><a href="etl.html#cb390-1"></a>train =<span class="st"> </span>train_imputed</span>
<span id="cb390-2"><a href="etl.html#cb390-2"></a>train<span class="op">$</span>term_deposit =<span class="st"> </span><span class="kw">factor</span>(train<span class="op">$</span>term_deposit)</span></code></pre></div>
</div>
<div id="transformación-de-variables" class="section level2">
<h2><span class="header-section-number">3.2</span> Transformación de variables</h2>
<p>Una vez se han obtenido las imputaciones de los missing values vamos a proceder a realizar una selección de variables. El procedimiento es el siguiente, nos enfocamos en la variable con menor importancia, entendiendo que una variable es importante si el peso dado en la regresión se encuentra alejado de 0. A esta variable tratamos de buscarla un tratamiento diferente que pueda mejorar el desempeño del modelo así como aumentar su importancia dentro del ranking.</p>
<p>Consideramos que una transformación mejora el desempeño si el F-score calculado mediante 10-fold cross validation mejora. Esta validación cruzada se ha aplicado en el conjunto de train, nunca en test para evitar sobreajustes.</p>
<div class="sourceCode" id="cb391"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb391-1"><a href="etl.html#cb391-1"></a>train.control &lt;-<span class="st"> </span><span class="kw">trainControl</span>(<span class="dt">method =</span> <span class="st">&quot;cv&quot;</span>, <span class="dt">number =</span> <span class="dv">10</span>, <span class="dt">summaryFunction=</span>prSummary,<span class="dt">classProbs =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<div class="sourceCode" id="cb392"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb392-1"><a href="etl.html#cb392-1"></a><span class="co"># Train the model</span></span>
<span id="cb392-2"><a href="etl.html#cb392-2"></a>model &lt;-<span class="st"> </span><span class="kw">train</span>(term_deposit <span class="op">~</span>., <span class="dt">data =</span> train, <span class="dt">method =</span> <span class="st">&quot;glm&quot;</span>,</span>
<span id="cb392-3"><a href="etl.html#cb392-3"></a>               <span class="dt">trControl =</span> train.control)</span></code></pre></div>
<pre><code>## Warning in train.default(x, y, weights = w, ...): The metric &quot;Accuracy&quot; was not
## in the result set. AUC will be used instead.</code></pre>
<div class="sourceCode" id="cb394"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb394-1"><a href="etl.html#cb394-1"></a><span class="co"># Summarize the results</span></span>
<span id="cb394-2"><a href="etl.html#cb394-2"></a><span class="kw">print</span>(model)</span></code></pre></div>
<pre><code>## Generalized Linear Model 
## 
## 34111 samples
##    16 predictor
##     2 classes: &#39;no&#39;, &#39;yes&#39; 
## 
## No pre-processing
## Resampling: Cross-Validated (10 fold) 
## Summary of sample sizes: 30701, 30699, 30700, 30700, 30699, 30699, ... 
## Resampling results:
## 
##   AUC        Precision  Recall    F        
##   0.9889767  0.9320116  0.981382  0.9560568</code></pre>
<div class="sourceCode" id="cb396"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb396-1"><a href="etl.html#cb396-1"></a>importance &lt;-<span class="st"> </span><span class="kw">varImp</span>(model, <span class="dt">scale=</span><span class="ot">FALSE</span>)</span>
<span id="cb396-2"><a href="etl.html#cb396-2"></a><span class="co"># summarize importance</span></span>
<span id="cb396-3"><a href="etl.html#cb396-3"></a><span class="kw">print</span>(<span class="kw">rownames</span>(importance<span class="op">$</span>importance))</span></code></pre></div>
<pre><code>##  [1] &quot;age&quot;                &quot;`jobblue-collar`&quot;   &quot;jobentrepreneur&quot;   
##  [4] &quot;jobhousemaid&quot;       &quot;jobmanagement&quot;      &quot;jobretired&quot;        
##  [7] &quot;`jobself-employed`&quot; &quot;jobservices&quot;        &quot;jobstudent&quot;        
## [10] &quot;jobtechnician&quot;      &quot;jobunemployed&quot;      &quot;maritalmarried&quot;    
## [13] &quot;maritalsingle&quot;      &quot;educationsecondary&quot; &quot;educationtertiary&quot; 
## [16] &quot;defaultyes&quot;         &quot;balance&quot;            &quot;housingyes&quot;        
## [19] &quot;loanyes&quot;            &quot;contacttelephone&quot;   &quot;contactunknown&quot;    
## [22] &quot;day&quot;                &quot;monthaug&quot;           &quot;monthdec&quot;          
## [25] &quot;monthfeb&quot;           &quot;monthjan&quot;           &quot;monthjul&quot;          
## [28] &quot;monthjun&quot;           &quot;monthmar&quot;           &quot;monthmay&quot;          
## [31] &quot;monthnov&quot;           &quot;monthoct&quot;           &quot;monthsep&quot;          
## [34] &quot;duration&quot;           &quot;campaign&quot;           &quot;pdays&quot;             
## [37] &quot;previous&quot;           &quot;poutcomeother&quot;      &quot;poutcomesuccess&quot;   
## [40] &quot;poutcomeunknown&quot;</code></pre>
<div id="train-poutcome" class="section level3">
<h3><span class="header-section-number">3.2.1</span> Train poutcome</h3>
<p>La variable categórica que informa del resultado en la última campaña es la menos informativa, vamos a probar a realizar una re-categorización donde agrupemos en una categoría las que tienen una menor probabilidad de contratar (failure, other y unknown) y en otra categoría success.</p>
<div class="sourceCode" id="cb398"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb398-1"><a href="etl.html#cb398-1"></a>poutcome_aprox &lt;-<span class="st"> </span>train</span>
<span id="cb398-2"><a href="etl.html#cb398-2"></a>poutcome_aprox[poutcome_aprox<span class="op">$</span>poutcome<span class="op">==</span><span class="st">&quot;failure&quot;</span> <span class="op">|</span><span class="st"> </span>poutcome_aprox<span class="op">$</span>poutcome<span class="op">==</span><span class="st">&quot;other&quot;</span> <span class="op">|</span><span class="st"> </span>poutcome_aprox<span class="op">$</span>poutcome<span class="op">==</span><span class="st">&quot;unknown&quot;</span>,<span class="st">&quot;poutcome&quot;</span>] &lt;-<span class="st"> &quot;bad_poutcome&quot;</span></span>
<span id="cb398-3"><a href="etl.html#cb398-3"></a>poutcome_aprox[poutcome_aprox<span class="op">$</span>poutcome<span class="op">==</span><span class="st">&quot;success&quot;</span>,<span class="st">&quot;poutcome&quot;</span>] &lt;-<span class="st"> &quot;success_poutcome&quot;</span></span></code></pre></div>
<div class="sourceCode" id="cb399"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb399-1"><a href="etl.html#cb399-1"></a>train.control &lt;-<span class="st"> </span><span class="kw">trainControl</span>(<span class="dt">method =</span> <span class="st">&quot;cv&quot;</span>, <span class="dt">number =</span> <span class="dv">10</span>, <span class="dt">summaryFunction=</span>prSummary,<span class="dt">classProbs =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<div class="sourceCode" id="cb400"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb400-1"><a href="etl.html#cb400-1"></a><span class="co"># Train the model</span></span>
<span id="cb400-2"><a href="etl.html#cb400-2"></a>model &lt;-<span class="st"> </span><span class="kw">train</span>(term_deposit <span class="op">~</span>., <span class="dt">data =</span> poutcome_aprox, <span class="dt">method =</span> <span class="st">&quot;glm&quot;</span>,</span>
<span id="cb400-3"><a href="etl.html#cb400-3"></a>               <span class="dt">trControl =</span> train.control)</span></code></pre></div>
<pre><code>## Warning in train.default(x, y, weights = w, ...): The metric &quot;Accuracy&quot; was not
## in the result set. AUC will be used instead.</code></pre>
<div class="sourceCode" id="cb402"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb402-1"><a href="etl.html#cb402-1"></a><span class="co"># Summarize the results</span></span>
<span id="cb402-2"><a href="etl.html#cb402-2"></a><span class="kw">print</span>(model)</span></code></pre></div>
<pre><code>## Generalized Linear Model 
## 
## 34111 samples
##    16 predictor
##     2 classes: &#39;no&#39;, &#39;yes&#39; 
## 
## No pre-processing
## Resampling: Cross-Validated (10 fold) 
## Summary of sample sizes: 30699, 30701, 30700, 30700, 30700, 30700, ... 
## Resampling results:
## 
##   AUC        Precision  Recall     F        
##   0.9888656  0.9318751  0.9814791  0.9560322</code></pre>
<p>Con esta nueva distribución de la variable no parece haber mejora ni cobrar mayor importancia en el ranking de variables, por lo que el siguiente paso sería a probar a eliminar dicha variable.</p>
</div>
<div id="variable-previous-1" class="section level3">
<h3><span class="header-section-number">3.2.2</span> Variable previous</h3>
<p>La siguiente variable con menor importancia es previous, variable cuantitativa que muestra el número de contactos que realizó el cliente en campañas anteriores. En este caso, tal y como hicimos en el exploratorio, vamos a categorizar esta variable en dos categorías: Sin contacto previo y contacto previo.</p>
<div class="sourceCode" id="cb404"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb404-1"><a href="etl.html#cb404-1"></a>previous_aprox &lt;-<span class="st">  </span>train <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">previous_categorica =</span> <span class="kw">cut</span>(previous, <span class="dt">breaks =</span>  <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">300</span>), <span class="dt">right =</span> <span class="ot">FALSE</span>, <span class="dt">include.lowest =</span> <span class="ot">TRUE</span>, <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&#39;Sin Contacto previo&#39;</span>, <span class="st">&#39;Contacto previo&#39;</span>)))</span>
<span id="cb404-2"><a href="etl.html#cb404-2"></a>previous_aprox<span class="op">$</span>previous &lt;-<span class="st"> </span><span class="ot">NULL</span></span></code></pre></div>
<div class="sourceCode" id="cb405"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb405-1"><a href="etl.html#cb405-1"></a>train.control &lt;-<span class="st"> </span><span class="kw">trainControl</span>(<span class="dt">method =</span> <span class="st">&quot;cv&quot;</span>, <span class="dt">number =</span> <span class="dv">10</span>, <span class="dt">summaryFunction=</span>prSummary,<span class="dt">classProbs =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<div class="sourceCode" id="cb406"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb406-1"><a href="etl.html#cb406-1"></a><span class="co"># Train the model</span></span>
<span id="cb406-2"><a href="etl.html#cb406-2"></a>model &lt;-<span class="st"> </span><span class="kw">train</span>(term_deposit <span class="op">~</span>., <span class="dt">data =</span> previous_aprox, <span class="dt">method =</span> <span class="st">&quot;glm&quot;</span>,</span>
<span id="cb406-3"><a href="etl.html#cb406-3"></a>               <span class="dt">trControl =</span> train.control)</span></code></pre></div>
<pre><code>## Warning in train.default(x, y, weights = w, ...): The metric &quot;Accuracy&quot; was not
## in the result set. AUC will be used instead.</code></pre>
<div class="sourceCode" id="cb408"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb408-1"><a href="etl.html#cb408-1"></a><span class="co"># Summarize the results</span></span>
<span id="cb408-2"><a href="etl.html#cb408-2"></a><span class="kw">print</span>(model)</span></code></pre></div>
<pre><code>## Generalized Linear Model 
## 
## 34111 samples
##    16 predictor
##     2 classes: &#39;no&#39;, &#39;yes&#39; 
## 
## No pre-processing
## Resampling: Cross-Validated (10 fold) 
## Summary of sample sizes: 30700, 30700, 30699, 30700, 30700, 30699, ... 
## Resampling results:
## 
##   AUC        Precision  Recall     F        
##   0.9889662  0.9319703  0.9811883  0.9559429</code></pre>
<p>Esta transformación de la variable previous no parece mejorar el desempeño del modelo.</p>
</div>
<div id="variable-pdays-1" class="section level3">
<h3><span class="header-section-number">3.2.3</span> Variable pdays</h3>
<p>La siguiente variable en el ranking es pdays, variable cuantitativa que muestra los días que han pasado desde que se contactó con él en la anterior campaña. En el exploratorio se ha propuesto ya una categorización que vamos a comprobar ahora.</p>
<div class="sourceCode" id="cb410"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb410-1"><a href="etl.html#cb410-1"></a>pdays_aprox =<span class="st"> </span>train <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">pdays_categorica =</span> <span class="kw">cut</span>(pdays, <span class="dt">breaks =</span>  <span class="kw">c</span>(<span class="op">-</span><span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">210</span>, <span class="dv">536</span>), <span class="dt">right =</span> <span class="ot">FALSE</span>, <span class="dt">include.lowest =</span> <span class="ot">TRUE</span>, <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&#39;No contacto&#39;</span>, <span class="st">&#39;&lt;7 Meses&#39;</span>, <span class="st">&#39;&gt;7 Meses&#39;</span>)))</span>
<span id="cb410-2"><a href="etl.html#cb410-2"></a>pdays_aprox<span class="op">$</span>pdays &lt;-<span class="st"> </span><span class="ot">NULL</span></span></code></pre></div>
<div class="sourceCode" id="cb411"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb411-1"><a href="etl.html#cb411-1"></a>train.control &lt;-<span class="st"> </span><span class="kw">trainControl</span>(<span class="dt">method =</span> <span class="st">&quot;cv&quot;</span>, <span class="dt">number =</span> <span class="dv">10</span>, <span class="dt">summaryFunction=</span>prSummary,<span class="dt">classProbs =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<div class="sourceCode" id="cb412"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb412-1"><a href="etl.html#cb412-1"></a><span class="co"># Train the model</span></span>
<span id="cb412-2"><a href="etl.html#cb412-2"></a>model &lt;-<span class="st"> </span><span class="kw">train</span>(term_deposit <span class="op">~</span>., <span class="dt">data =</span> pdays_aprox, <span class="dt">method =</span> <span class="st">&quot;glm&quot;</span>,</span>
<span id="cb412-3"><a href="etl.html#cb412-3"></a>               <span class="dt">trControl =</span> train.control)</span></code></pre></div>
<pre><code>## Warning in train.default(x, y, weights = w, ...): The metric &quot;Accuracy&quot; was not
## in the result set. AUC will be used instead.</code></pre>
<div class="sourceCode" id="cb414"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb414-1"><a href="etl.html#cb414-1"></a><span class="co"># Summarize the results</span></span>
<span id="cb414-2"><a href="etl.html#cb414-2"></a><span class="kw">print</span>(model)</span></code></pre></div>
<pre><code>## Generalized Linear Model 
## 
## 34111 samples
##    16 predictor
##     2 classes: &#39;no&#39;, &#39;yes&#39; 
## 
## No pre-processing
## Resampling: Cross-Validated (10 fold) 
## Summary of sample sizes: 30701, 30700, 30700, 30699, 30700, 30700, ... 
## Resampling results:
## 
##   AUC        Precision  Recall     F        
##   0.9889236  0.9319423  0.9811556  0.9559117</code></pre>
<p>Con la categorización de la variable pdays el modelo no parece mejorar.</p>
</div>
<div id="variable-campaign-1" class="section level3">
<h3><span class="header-section-number">3.2.4</span> Variable campaign</h3>
<p>La siguiente variable es campaign, variable cuantitativa que muestra el número de contactos en esta campaña. Ya en el EDA se ha propuesto una categorización que vamos a analizar a continuación.</p>
<div class="sourceCode" id="cb416"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb416-1"><a href="etl.html#cb416-1"></a>campaign_aprox =<span class="st"> </span>train <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">campaign_binaria =</span> <span class="kw">cut</span>(campaign, <span class="dt">breaks =</span>  <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">300</span>), <span class="dt">right =</span> <span class="ot">FALSE</span>, <span class="dt">include.lowest =</span> <span class="ot">TRUE</span>, <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&#39;1Contacto&#39;</span>, <span class="st">&#39;+1Contacto&#39;</span>)))</span>
<span id="cb416-2"><a href="etl.html#cb416-2"></a>campaign_aprox<span class="op">$</span>campaign &lt;-<span class="st"> </span><span class="ot">NULL</span></span></code></pre></div>
<div class="sourceCode" id="cb417"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb417-1"><a href="etl.html#cb417-1"></a>train.control &lt;-<span class="st"> </span><span class="kw">trainControl</span>(<span class="dt">method =</span> <span class="st">&quot;cv&quot;</span>, <span class="dt">number =</span> <span class="dv">10</span>, <span class="dt">summaryFunction=</span>prSummary,<span class="dt">classProbs =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<div class="sourceCode" id="cb418"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb418-1"><a href="etl.html#cb418-1"></a><span class="co"># Train the model</span></span>
<span id="cb418-2"><a href="etl.html#cb418-2"></a>model &lt;-<span class="st"> </span><span class="kw">train</span>(term_deposit <span class="op">~</span>., <span class="dt">data =</span> campaign_aprox, <span class="dt">method =</span> <span class="st">&quot;glm&quot;</span>,</span>
<span id="cb418-3"><a href="etl.html#cb418-3"></a>               <span class="dt">trControl =</span> train.control)</span></code></pre></div>
<pre><code>## Warning in train.default(x, y, weights = w, ...): The metric &quot;Accuracy&quot; was not
## in the result set. AUC will be used instead.</code></pre>
<div class="sourceCode" id="cb420"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb420-1"><a href="etl.html#cb420-1"></a><span class="co"># Summarize the results</span></span>
<span id="cb420-2"><a href="etl.html#cb420-2"></a><span class="kw">print</span>(model)</span></code></pre></div>
<pre><code>## Generalized Linear Model 
## 
## 34111 samples
##    16 predictor
##     2 classes: &#39;no&#39;, &#39;yes&#39; 
## 
## No pre-processing
## Resampling: Cross-Validated (10 fold) 
## Summary of sample sizes: 30700, 30701, 30699, 30700, 30700, 30700, ... 
## Resampling results:
## 
##   AUC        Precision  Recall     F       
##   0.9889353  0.9322811  0.9815437  0.956275</code></pre>
<p>El nuevo tratamiento de la variable campaign mejora el desempeño del modelo.</p>
<div class="sourceCode" id="cb422"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb422-1"><a href="etl.html#cb422-1"></a>train &lt;-<span class="st"> </span>campaign_aprox</span></code></pre></div>
</div>
<div id="variable-duration-1" class="section level3">
<h3><span class="header-section-number">3.2.5</span> Variable duration</h3>
<p>La siguiente variable es duration, variable cuantitativa que muestra la duración en segundos del último contacto mantenido con el cliente. En el EDA se ha propuesto realizar una transformación logarítmica a la variable para tratar de mejorar las diferencias entre la distribución de esta variable en los casos de contratación de los que no.</p>
<div class="sourceCode" id="cb423"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb423-1"><a href="etl.html#cb423-1"></a>duration_aprox &lt;-<span class="st"> </span>train[train<span class="op">$</span>duration<span class="op">&gt;</span><span class="dv">0</span>,]</span>
<span id="cb423-2"><a href="etl.html#cb423-2"></a>duration_aprox<span class="op">$</span>duration &lt;-<span class="st"> </span><span class="kw">log10</span>(duration_aprox<span class="op">$</span>duration)</span></code></pre></div>
<div class="sourceCode" id="cb424"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb424-1"><a href="etl.html#cb424-1"></a>train.control &lt;-<span class="st"> </span><span class="kw">trainControl</span>(<span class="dt">method =</span> <span class="st">&quot;cv&quot;</span>, <span class="dt">number =</span> <span class="dv">10</span>, <span class="dt">summaryFunction=</span>prSummary,<span class="dt">classProbs =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<div class="sourceCode" id="cb425"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb425-1"><a href="etl.html#cb425-1"></a><span class="co"># Train the model</span></span>
<span id="cb425-2"><a href="etl.html#cb425-2"></a>model &lt;-<span class="st"> </span><span class="kw">train</span>(term_deposit <span class="op">~</span>., <span class="dt">data =</span> duration_aprox, <span class="dt">method =</span> <span class="st">&quot;glm&quot;</span>,</span>
<span id="cb425-3"><a href="etl.html#cb425-3"></a>               <span class="dt">trControl =</span> train.control)</span></code></pre></div>
<pre><code>## Warning in train.default(x, y, weights = w, ...): The metric &quot;Accuracy&quot; was not
## in the result set. AUC will be used instead.</code></pre>
<div class="sourceCode" id="cb427"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb427-1"><a href="etl.html#cb427-1"></a><span class="co"># Summarize the results</span></span>
<span id="cb427-2"><a href="etl.html#cb427-2"></a><span class="kw">print</span>(model)</span></code></pre></div>
<pre><code>## Generalized Linear Model 
## 
## 34108 samples
##    16 predictor
##     2 classes: &#39;no&#39;, &#39;yes&#39; 
## 
## No pre-processing
## Resampling: Cross-Validated (10 fold) 
## Summary of sample sizes: 30697, 30697, 30698, 30698, 30698, 30696, ... 
## Resampling results:
## 
##   AUC        Precision  Recall     F        
##   0.9887624  0.932604   0.9812509  0.9563054</code></pre>
<p>Este tratamiento parece mejorar el desempeño del modelo.</p>
<div class="sourceCode" id="cb429"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb429-1"><a href="etl.html#cb429-1"></a>train &lt;-<span class="st"> </span>duration_aprox</span></code></pre></div>
</div>
<div id="variable-month" class="section level3">
<h3><span class="header-section-number">3.2.6</span> Variable month</h3>
<p>Variable categórica que indica el mes en el que se produce el contacto actual con el cliente. Vamos a re-categorizar la variable en dos categorias en función de si es un mes con alto índice de contrataciones o no.</p>
<div class="sourceCode" id="cb430"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb430-1"><a href="etl.html#cb430-1"></a>month_aprox &lt;-<span class="st"> </span>train</span></code></pre></div>
<div class="sourceCode" id="cb431"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb431-1"><a href="etl.html#cb431-1"></a>month_aprox[month_aprox<span class="op">$</span>month<span class="op">==</span><span class="st">&quot;jan&quot;</span>,<span class="st">&quot;month&quot;</span>] &lt;-<span class="st"> &quot;no_month&quot;</span></span>
<span id="cb431-2"><a href="etl.html#cb431-2"></a>month_aprox[month_aprox<span class="op">$</span>month<span class="op">==</span><span class="st">&quot;feb&quot;</span>,<span class="st">&quot;month&quot;</span>] &lt;-<span class="st"> &quot;no_month&quot;</span></span>
<span id="cb431-3"><a href="etl.html#cb431-3"></a>month_aprox[month_aprox<span class="op">$</span>month<span class="op">==</span><span class="st">&quot;mar&quot;</span>,<span class="st">&quot;month&quot;</span>] &lt;-<span class="st"> &quot;yes_month&quot;</span></span>
<span id="cb431-4"><a href="etl.html#cb431-4"></a>month_aprox[month_aprox<span class="op">$</span>month<span class="op">==</span><span class="st">&quot;apr&quot;</span>,<span class="st">&quot;month&quot;</span>] &lt;-<span class="st"> &quot;no_month&quot;</span></span>
<span id="cb431-5"><a href="etl.html#cb431-5"></a>month_aprox[month_aprox<span class="op">$</span>month<span class="op">==</span><span class="st">&quot;may&quot;</span>,<span class="st">&quot;month&quot;</span>] &lt;-<span class="st"> &quot;no_month&quot;</span></span>
<span id="cb431-6"><a href="etl.html#cb431-6"></a>month_aprox[month_aprox<span class="op">$</span>month<span class="op">==</span><span class="st">&quot;jun&quot;</span>,<span class="st">&quot;month&quot;</span>] &lt;-<span class="st"> &quot;no_month&quot;</span></span>
<span id="cb431-7"><a href="etl.html#cb431-7"></a>month_aprox[month_aprox<span class="op">$</span>month<span class="op">==</span><span class="st">&quot;jul&quot;</span>,<span class="st">&quot;month&quot;</span>] &lt;-<span class="st"> &quot;no_month&quot;</span></span>
<span id="cb431-8"><a href="etl.html#cb431-8"></a>month_aprox[month_aprox<span class="op">$</span>month<span class="op">==</span><span class="st">&quot;aug&quot;</span>,<span class="st">&quot;month&quot;</span>] &lt;-<span class="st"> &quot;no_month&quot;</span></span>
<span id="cb431-9"><a href="etl.html#cb431-9"></a>month_aprox[month_aprox<span class="op">$</span>month<span class="op">==</span><span class="st">&quot;sep&quot;</span>,<span class="st">&quot;month&quot;</span>] &lt;-<span class="st"> &quot;yes_month&quot;</span></span>
<span id="cb431-10"><a href="etl.html#cb431-10"></a>month_aprox[month_aprox<span class="op">$</span>month<span class="op">==</span><span class="st">&quot;oct&quot;</span>,<span class="st">&quot;month&quot;</span>] &lt;-<span class="st"> &quot;yes_month&quot;</span></span>
<span id="cb431-11"><a href="etl.html#cb431-11"></a>month_aprox[month_aprox<span class="op">$</span>month<span class="op">==</span><span class="st">&quot;nov&quot;</span>,<span class="st">&quot;month&quot;</span>] &lt;-<span class="st"> &quot;no_month&quot;</span></span>
<span id="cb431-12"><a href="etl.html#cb431-12"></a>month_aprox[month_aprox<span class="op">$</span>month<span class="op">==</span><span class="st">&quot;dec&quot;</span>,<span class="st">&quot;month&quot;</span>] &lt;-<span class="st"> &quot;yes_month&quot;</span></span></code></pre></div>
<div class="sourceCode" id="cb432"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb432-1"><a href="etl.html#cb432-1"></a>train.control &lt;-<span class="st"> </span><span class="kw">trainControl</span>(<span class="dt">method =</span> <span class="st">&quot;cv&quot;</span>, <span class="dt">number =</span> <span class="dv">10</span>, <span class="dt">summaryFunction=</span>prSummary,<span class="dt">classProbs =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<div class="sourceCode" id="cb433"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb433-1"><a href="etl.html#cb433-1"></a><span class="co"># Train the model</span></span>
<span id="cb433-2"><a href="etl.html#cb433-2"></a>model &lt;-<span class="st"> </span><span class="kw">train</span>(term_deposit <span class="op">~</span>., <span class="dt">data =</span> month_aprox, <span class="dt">method =</span> <span class="st">&quot;glm&quot;</span>,</span>
<span id="cb433-3"><a href="etl.html#cb433-3"></a>               <span class="dt">trControl =</span> train.control)</span></code></pre></div>
<pre><code>## Warning in train.default(x, y, weights = w, ...): The metric &quot;Accuracy&quot; was not
## in the result set. AUC will be used instead.</code></pre>
<div class="sourceCode" id="cb435"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb435-1"><a href="etl.html#cb435-1"></a><span class="co"># Summarize the results</span></span>
<span id="cb435-2"><a href="etl.html#cb435-2"></a><span class="kw">print</span>(model)</span></code></pre></div>
<pre><code>## Generalized Linear Model 
## 
## 34108 samples
##    16 predictor
##     2 classes: &#39;no&#39;, &#39;yes&#39; 
## 
## No pre-processing
## Resampling: Cross-Validated (10 fold) 
## Summary of sample sizes: 30696, 30698, 30698, 30697, 30696, 30697, ... 
## Resampling results:
## 
##   AUC        Precision  Recall     F        
##   0.9878167  0.9303059  0.9820266  0.9554642</code></pre>
<p>Este nuevo tratamiento no mejora el desempeño del modelo.</p>
</div>
<div id="variable-contact-1" class="section level3">
<h3><span class="header-section-number">3.2.7</span> Variable contact</h3>
<p>Variable categórica que indica la forma en la que se contactó con el cliente. Vamos a tratar de reducir las categorías a escala binaria en función de si es unknown o no.</p>
<div class="sourceCode" id="cb437"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb437-1"><a href="etl.html#cb437-1"></a>contact_aprox &lt;-<span class="st"> </span>train</span>
<span id="cb437-2"><a href="etl.html#cb437-2"></a>contact_aprox[contact_aprox<span class="op">$</span>contact<span class="op">==</span><span class="st">&quot;unknown&quot;</span>,<span class="st">&quot;contact&quot;</span>] &lt;-<span class="st"> &quot;unknown&quot;</span></span>
<span id="cb437-3"><a href="etl.html#cb437-3"></a>contact_aprox[contact_aprox<span class="op">$</span>contact<span class="op">!=</span><span class="st">&quot;unknown&quot;</span>,<span class="st">&quot;contact&quot;</span>] &lt;-<span class="st"> &quot;not_unknown&quot;</span></span></code></pre></div>
<div class="sourceCode" id="cb438"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb438-1"><a href="etl.html#cb438-1"></a>train.control &lt;-<span class="st"> </span><span class="kw">trainControl</span>(<span class="dt">method =</span> <span class="st">&quot;cv&quot;</span>, <span class="dt">number =</span> <span class="dv">10</span>, <span class="dt">summaryFunction=</span>prSummary,<span class="dt">classProbs =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<div class="sourceCode" id="cb439"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb439-1"><a href="etl.html#cb439-1"></a><span class="co"># Train the model</span></span>
<span id="cb439-2"><a href="etl.html#cb439-2"></a>model &lt;-<span class="st"> </span><span class="kw">train</span>(term_deposit <span class="op">~</span>., <span class="dt">data =</span> contact_aprox, <span class="dt">method =</span> <span class="st">&quot;glm&quot;</span>,</span>
<span id="cb439-3"><a href="etl.html#cb439-3"></a>               <span class="dt">trControl =</span> train.control)</span></code></pre></div>
<pre><code>## Warning in train.default(x, y, weights = w, ...): The metric &quot;Accuracy&quot; was not
## in the result set. AUC will be used instead.</code></pre>
<div class="sourceCode" id="cb441"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb441-1"><a href="etl.html#cb441-1"></a><span class="co"># Summarize the results</span></span>
<span id="cb441-2"><a href="etl.html#cb441-2"></a><span class="kw">print</span>(model)</span></code></pre></div>
<pre><code>## Generalized Linear Model 
## 
## 34108 samples
##    16 predictor
##     2 classes: &#39;no&#39;, &#39;yes&#39; 
## 
## No pre-processing
## Resampling: Cross-Validated (10 fold) 
## Summary of sample sizes: 30696, 30698, 30697, 30696, 30698, 30698, ... 
## Resampling results:
## 
##   AUC        Precision  Recall     F        
##   0.9887404  0.9327847  0.9810894  0.9563258</code></pre>
<p>Este nuevo tratamiento parece mejorar el desempeño del modelo.</p>
<div class="sourceCode" id="cb443"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb443-1"><a href="etl.html#cb443-1"></a>train &lt;-<span class="st"> </span>contact_aprox</span></code></pre></div>
</div>
<div id="variable-balance-1" class="section level3">
<h3><span class="header-section-number">3.2.8</span> Variable balance</h3>
<p>Variable cuantitativa que indica el saldo del cliente. En el exploratorio se ha propuesto categorizar esta variable en 4 categorías (saldo negativo, bajo, medio y alto).</p>
<div class="sourceCode" id="cb444"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb444-1"><a href="etl.html#cb444-1"></a>balance_aprox =<span class="st"> </span>train <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">balance_categorica =</span> <span class="kw">cut</span>(balance, <span class="dt">breaks =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">10000</span>, <span class="dv">0</span>, <span class="dv">2000</span>, <span class="dv">10000</span>, <span class="dv">105000</span>), <span class="dt">right =</span> <span class="ot">FALSE</span>, <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&#39;Negativo&#39;</span>,<span class="st">&#39;Bajo&#39;</span>,<span class="st">&#39;Medio&#39;</span>, <span class="st">&#39;Alto&#39;</span>)))</span></code></pre></div>
<div class="sourceCode" id="cb445"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb445-1"><a href="etl.html#cb445-1"></a>train.control &lt;-<span class="st"> </span><span class="kw">trainControl</span>(<span class="dt">method =</span> <span class="st">&quot;cv&quot;</span>, <span class="dt">number =</span> <span class="dv">10</span>, <span class="dt">summaryFunction=</span>prSummary,<span class="dt">classProbs =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<div class="sourceCode" id="cb446"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb446-1"><a href="etl.html#cb446-1"></a><span class="co"># Train the model</span></span>
<span id="cb446-2"><a href="etl.html#cb446-2"></a>model &lt;-<span class="st"> </span><span class="kw">train</span>(term_deposit <span class="op">~</span>., <span class="dt">data =</span> balance_aprox, <span class="dt">method =</span> <span class="st">&quot;glm&quot;</span>,</span>
<span id="cb446-3"><a href="etl.html#cb446-3"></a>               <span class="dt">trControl =</span> train.control)</span></code></pre></div>
<pre><code>## Warning in train.default(x, y, weights = w, ...): The metric &quot;Accuracy&quot; was not
## in the result set. AUC will be used instead.</code></pre>
<div class="sourceCode" id="cb448"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb448-1"><a href="etl.html#cb448-1"></a><span class="co"># Summarize the results</span></span>
<span id="cb448-2"><a href="etl.html#cb448-2"></a><span class="kw">print</span>(model)</span></code></pre></div>
<pre><code>## Generalized Linear Model 
## 
## 34108 samples
##    17 predictor
##     2 classes: &#39;no&#39;, &#39;yes&#39; 
## 
## No pre-processing
## Resampling: Cross-Validated (10 fold) 
## Summary of sample sizes: 30697, 30697, 30698, 30698, 30696, 30698, ... 
## Resampling results:
## 
##   AUC        Precision  Recall     F        
##   0.9888094  0.9327786  0.9809278  0.9562439</code></pre>
<p>Este tratamiento no aporta beneficio al modelo.</p>
</div>
<div id="variable-age-1" class="section level3">
<h3><span class="header-section-number">3.2.9</span> Variable age</h3>
<p>Variable cuantitativa que indica la edad del cliente. En el exploratorio se ha propuesto categorizar esta variable en 4 grupos (ancianos, mayores, joven y mediana edad).</p>
<div class="sourceCode" id="cb450"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb450-1"><a href="etl.html#cb450-1"></a>age_aprox =<span class="st"> </span>train <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">age_categorica =</span> <span class="kw">cut</span>(age, <span class="dt">breaks =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">29</span>, <span class="dv">44</span>, <span class="dv">59</span>, <span class="dv">100</span>), <span class="dt">right =</span> <span class="ot">TRUE</span>, <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&#39;Joven&#39;</span>,<span class="st">&#39;MedianaEdad&#39;</span>,<span class="st">&#39;Mayores&#39;</span>,<span class="st">&#39;Ancianos&#39;</span>)))</span>
<span id="cb450-2"><a href="etl.html#cb450-2"></a>age_aprox<span class="op">$</span>age &lt;-<span class="st"> </span><span class="ot">NULL</span></span></code></pre></div>
<div class="sourceCode" id="cb451"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb451-1"><a href="etl.html#cb451-1"></a>train.control &lt;-<span class="st"> </span><span class="kw">trainControl</span>(<span class="dt">method =</span> <span class="st">&quot;cv&quot;</span>, <span class="dt">number =</span> <span class="dv">10</span>, <span class="dt">summaryFunction=</span>prSummary,<span class="dt">classProbs =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<div class="sourceCode" id="cb452"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb452-1"><a href="etl.html#cb452-1"></a><span class="co"># Train the model</span></span>
<span id="cb452-2"><a href="etl.html#cb452-2"></a>model &lt;-<span class="st"> </span><span class="kw">train</span>(term_deposit <span class="op">~</span>., <span class="dt">data =</span> age_aprox, <span class="dt">method =</span> <span class="st">&quot;glm&quot;</span>,</span>
<span id="cb452-3"><a href="etl.html#cb452-3"></a>               <span class="dt">trControl =</span> train.control)</span></code></pre></div>
<pre><code>## Warning in train.default(x, y, weights = w, ...): The metric &quot;Accuracy&quot; was not
## in the result set. AUC will be used instead.</code></pre>
<div class="sourceCode" id="cb454"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb454-1"><a href="etl.html#cb454-1"></a><span class="co"># Summarize the results</span></span>
<span id="cb454-2"><a href="etl.html#cb454-2"></a><span class="kw">print</span>(model)</span></code></pre></div>
<pre><code>## Generalized Linear Model 
## 
## 34108 samples
##    16 predictor
##     2 classes: &#39;no&#39;, &#39;yes&#39; 
## 
## No pre-processing
## Resampling: Cross-Validated (10 fold) 
## Summary of sample sizes: 30697, 30697, 30696, 30698, 30697, 30698, ... 
## Resampling results:
## 
##   AUC       Precision  Recall     F        
##   0.989032  0.9332993  0.9809925  0.9565504</code></pre>
<p>En este caso el modelo mejora con este tratamiento.</p>
<div class="sourceCode" id="cb456"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb456-1"><a href="etl.html#cb456-1"></a>train &lt;-<span class="st"> </span>age_aprox</span></code></pre></div>
</div>
</div>
<div id="selección-de-variables" class="section level2">
<h2><span class="header-section-number">3.3</span> Selección de variables</h2>
<p>Una vez hemos decidido las transformaciones de variables a aplicar vamos a seleccionar las variables predictoras que utilizar en el modelo. Para ello se han utilizado tres métodos de selección, los tres de tipo <strong>wrapper</strong>. Estas aproximaciones son bakward, forward y both. Las tres aproximaciones se basan en una búsqueda de la mejor configuración de variables en base a optimizar el AIC del modelo.</p>
<div class="sourceCode" id="cb457"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb457-1"><a href="etl.html#cb457-1"></a>model &lt;-<span class="st"> </span><span class="kw">glm</span>(term_deposit <span class="op">~</span><span class="st"> </span>., <span class="dt">data =</span> train,<span class="dt">family=</span><span class="st">&#39;binomial&#39;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb458"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb458-1"><a href="etl.html#cb458-1"></a>backward_selection &lt;-<span class="st"> </span><span class="kw">stepAIC</span>(model, <span class="dt">trace=</span><span class="ot">FALSE</span>, <span class="dt">direction=</span><span class="st">&quot;backward&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb459"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb459-1"><a href="etl.html#cb459-1"></a><span class="kw">summary</span>(backward_selection)</span></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = term_deposit ~ job + marital + education + balance + 
##     housing + loan + contact + day + month + duration + pdays + 
##     poutcome + campaign_binaria + age_categorica, family = &quot;binomial&quot;, 
##     data = train)
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -3.3087  -0.3346  -0.1702  -0.0797   4.3082  
## 
## Coefficients:
##                              Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)                -1.225e+01  2.930e-01 -41.802  &lt; 2e-16 ***
## jobblue-collar             -2.584e-01  8.881e-02  -2.910 0.003617 ** 
## jobentrepreneur            -5.423e-01  1.572e-01  -3.450 0.000562 ***
## jobhousemaid               -7.257e-01  1.763e-01  -4.115 3.87e-05 ***
## jobmanagement              -2.481e-01  9.433e-02  -2.630 0.008529 ** 
## jobretired                 -2.328e-01  1.347e-01  -1.728 0.083902 .  
## jobself-employed           -4.134e-01  1.411e-01  -2.931 0.003380 ** 
## jobservices                -2.470e-01  1.034e-01  -2.389 0.016897 *  
## jobstudent                  2.538e-01  1.527e-01   1.662 0.096551 .  
## jobtechnician              -1.785e-01  8.748e-02  -2.040 0.041355 *  
## jobunemployed              -3.030e-01  1.448e-01  -2.092 0.036432 *  
## maritalmarried             -2.781e-01  7.185e-02  -3.871 0.000109 ***
## maritalsingle              -1.306e-01  8.176e-02  -1.597 0.110198    
## educationsecondary          4.173e-02  7.754e-02   0.538 0.590411    
## educationtertiary           3.712e-01  9.259e-02   4.009 6.10e-05 ***
## balance                     1.759e-05  6.565e-06   2.679 0.007377 ** 
## housingyes                 -5.076e-01  5.540e-02  -9.161  &lt; 2e-16 ***
## loanyes                    -2.630e-01  7.030e-02  -3.741 0.000183 ***
## contactunknown             -1.669e+00  8.637e-02 -19.323  &lt; 2e-16 ***
## day                         1.280e-02  3.273e-03   3.912 9.17e-05 ***
## monthaug                   -4.871e-01  1.018e-01  -4.786 1.70e-06 ***
## monthdec                    8.613e-01  2.130e-01   4.044 5.25e-05 ***
## monthfeb                   -7.919e-02  1.247e-01  -0.635 0.525266    
## monthjan                   -1.699e+00  1.814e-01  -9.363  &lt; 2e-16 ***
## monthjul                   -8.772e-01  9.904e-02  -8.857  &lt; 2e-16 ***
## monthjun                    8.273e-01  1.214e-01   6.815 9.45e-12 ***
## monthmar                    2.741e+00  1.847e-01  14.835  &lt; 2e-16 ***
## monthmay                   -1.108e-01  9.160e-02  -1.209 0.226588    
## monthnov                   -6.073e-01  1.039e-01  -5.846 5.04e-09 ***
## monthoct                    1.671e+00  1.498e-01  11.156  &lt; 2e-16 ***
## monthsep                    1.190e+00  1.933e-01   6.157 7.41e-10 ***
## duration                    4.826e+00  8.355e-02  57.764  &lt; 2e-16 ***
## pdays                      -3.077e-03  5.098e-04  -6.036 1.58e-09 ***
## poutcomeother               6.015e-02  1.293e-01   0.465 0.641801    
## poutcomesuccess             1.837e+00  1.284e-01  14.307  &lt; 2e-16 ***
## poutcomeunknown            -7.150e-01  1.354e-01  -5.281 1.28e-07 ***
## campaign_binaria+1Contacto -3.019e-01  4.784e-02  -6.310 2.79e-10 ***
## age_categoricaMedianaEdad  -3.433e-01  7.357e-02  -4.666 3.08e-06 ***
## age_categoricaMayores      -3.929e-01  8.663e-02  -4.535 5.76e-06 ***
## age_categoricaAncianos      4.974e-01  1.455e-01   3.419 0.000629 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 21112  on 34107  degrees of freedom
## Residual deviance: 13348  on 34068  degrees of freedom
## AIC: 13428
## 
## Number of Fisher Scoring iterations: 7</code></pre>
<div class="sourceCode" id="cb461"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb461-1"><a href="etl.html#cb461-1"></a>empty_model &lt;-<span class="st"> </span><span class="kw">glm</span>(term_deposit <span class="op">~</span><span class="st"> </span><span class="dv">1</span>, <span class="dt">data=</span>train, <span class="dt">family=</span><span class="st">&#39;binomial&#39;</span>)</span>
<span id="cb461-2"><a href="etl.html#cb461-2"></a>horizonte &lt;-<span class="st"> </span><span class="kw">formula</span>(term_deposit <span class="op">~</span><span class="st"> </span>age_categorica <span class="op">+</span><span class="st"> </span>job <span class="op">+</span><span class="st"> </span>marital <span class="op">+</span><span class="st"> </span>education <span class="op">+</span><span class="st"> </span>default <span class="op">+</span><span class="st"> </span>balance <span class="op">+</span><span class="st"> </span>housing <span class="op">+</span><span class="st"> </span>loan <span class="op">+</span><span class="st"> </span>contact <span class="op">+</span><span class="st"> </span>day <span class="op">+</span><span class="st"> </span>month <span class="op">+</span><span class="st"> </span>duration <span class="op">+</span><span class="st"> </span>campaign_binaria <span class="op">+</span><span class="st"> </span>pdays <span class="op">+</span><span class="st"> </span>previous <span class="op">+</span><span class="st"> </span>poutcome)</span></code></pre></div>
<div class="sourceCode" id="cb462"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb462-1"><a href="etl.html#cb462-1"></a>forward_selection &lt;-<span class="st"> </span><span class="kw">stepAIC</span>(empty_model, <span class="dt">trace=</span><span class="ot">FALSE</span>, <span class="dt">direction=</span><span class="st">&quot;forward&quot;</span>, <span class="dt">scope=</span>horizonte)</span></code></pre></div>
<div class="sourceCode" id="cb463"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb463-1"><a href="etl.html#cb463-1"></a><span class="kw">summary</span>(forward_selection)</span></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = term_deposit ~ duration + month + contact + poutcome + 
##     housing + age_categorica + education + pdays + campaign_binaria + 
##     job + loan + marital + day + balance, family = &quot;binomial&quot;, 
##     data = train)
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -3.3087  -0.3346  -0.1702  -0.0797   4.3082  
## 
## Coefficients:
##                              Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)                -1.225e+01  2.930e-01 -41.802  &lt; 2e-16 ***
## duration                    4.826e+00  8.355e-02  57.764  &lt; 2e-16 ***
## monthaug                   -4.871e-01  1.018e-01  -4.786 1.70e-06 ***
## monthdec                    8.613e-01  2.130e-01   4.044 5.25e-05 ***
## monthfeb                   -7.919e-02  1.247e-01  -0.635 0.525266    
## monthjan                   -1.699e+00  1.814e-01  -9.363  &lt; 2e-16 ***
## monthjul                   -8.772e-01  9.904e-02  -8.857  &lt; 2e-16 ***
## monthjun                    8.273e-01  1.214e-01   6.815 9.45e-12 ***
## monthmar                    2.741e+00  1.847e-01  14.835  &lt; 2e-16 ***
## monthmay                   -1.108e-01  9.160e-02  -1.209 0.226588    
## monthnov                   -6.073e-01  1.039e-01  -5.846 5.04e-09 ***
## monthoct                    1.671e+00  1.498e-01  11.156  &lt; 2e-16 ***
## monthsep                    1.190e+00  1.933e-01   6.157 7.41e-10 ***
## contactunknown             -1.669e+00  8.637e-02 -19.323  &lt; 2e-16 ***
## poutcomeother               6.015e-02  1.293e-01   0.465 0.641801    
## poutcomesuccess             1.837e+00  1.284e-01  14.307  &lt; 2e-16 ***
## poutcomeunknown            -7.150e-01  1.354e-01  -5.281 1.28e-07 ***
## housingyes                 -5.076e-01  5.540e-02  -9.161  &lt; 2e-16 ***
## age_categoricaMedianaEdad  -3.433e-01  7.357e-02  -4.666 3.08e-06 ***
## age_categoricaMayores      -3.929e-01  8.663e-02  -4.535 5.76e-06 ***
## age_categoricaAncianos      4.974e-01  1.455e-01   3.419 0.000629 ***
## educationsecondary          4.173e-02  7.754e-02   0.538 0.590411    
## educationtertiary           3.712e-01  9.259e-02   4.009 6.10e-05 ***
## pdays                      -3.077e-03  5.098e-04  -6.036 1.58e-09 ***
## campaign_binaria+1Contacto -3.019e-01  4.784e-02  -6.310 2.79e-10 ***
## jobblue-collar             -2.584e-01  8.881e-02  -2.910 0.003617 ** 
## jobentrepreneur            -5.423e-01  1.572e-01  -3.450 0.000562 ***
## jobhousemaid               -7.257e-01  1.763e-01  -4.115 3.87e-05 ***
## jobmanagement              -2.481e-01  9.433e-02  -2.630 0.008529 ** 
## jobretired                 -2.328e-01  1.347e-01  -1.728 0.083902 .  
## jobself-employed           -4.134e-01  1.411e-01  -2.931 0.003380 ** 
## jobservices                -2.470e-01  1.034e-01  -2.389 0.016897 *  
## jobstudent                  2.538e-01  1.527e-01   1.662 0.096551 .  
## jobtechnician              -1.785e-01  8.748e-02  -2.040 0.041355 *  
## jobunemployed              -3.030e-01  1.448e-01  -2.092 0.036432 *  
## loanyes                    -2.630e-01  7.030e-02  -3.741 0.000183 ***
## maritalmarried             -2.781e-01  7.185e-02  -3.871 0.000109 ***
## maritalsingle              -1.306e-01  8.176e-02  -1.597 0.110198    
## day                         1.280e-02  3.273e-03   3.912 9.17e-05 ***
## balance                     1.759e-05  6.565e-06   2.679 0.007377 ** 
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 21112  on 34107  degrees of freedom
## Residual deviance: 13348  on 34068  degrees of freedom
## AIC: 13428
## 
## Number of Fisher Scoring iterations: 7</code></pre>
<div class="sourceCode" id="cb465"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb465-1"><a href="etl.html#cb465-1"></a>both_selection &lt;-<span class="st"> </span><span class="kw">stepAIC</span>(empty_model, <span class="dt">trace=</span><span class="ot">FALSE</span>, <span class="dt">direction=</span><span class="st">&quot;both&quot;</span>, <span class="dt">scope=</span>horizonte)</span></code></pre></div>
<p>Con las tres aproximaciones se ha llegado al mismo resultado de las mismas 14 variables predictoras, por ello a la hora de realizar el modelado solo se va a utilizar un modelo.</p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="análisis-exploratorio-variables.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="modelado.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="book_assets/gitbook-2.6.7/js/app.min.js"></script>
<script src="book_assets/gitbook-2.6.7/js/lunr.js"></script>
<script src="book_assets/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="book_assets/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="book_assets/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="book_assets/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="book_assets/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="book_assets/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="book_assets/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
},
"search": false
});
});
</script>

</body>

</html>
